#!/usr/bin/env bash

ensure_paths_exist "$previous_path" "$discarded_path"

previous="$(\ls -t "$previous_path"/ | head -n 1)"

if [[ -d "$previous" ]] ; then
  log "Discarding current release to $discarded_path/$timestamp ..."

  mv "$current_path" "$discarded_path/$timestamp"

  log "Rolling back to previous release $previous ..."

  mv "$previous" "${current_path%/}"

  log "Rolled back to previous release $previous."
else
  log "Previous release was not found in $previous_path/"
fi
