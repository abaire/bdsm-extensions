#!/usr/bin/env bash

log "Initializing postgresql $version data directory in $pgsql_path/$version"
log " with superuser set to '$user'..."

ensure_paths_exist "$pgsql_path/$version"

$sudo chown -R $user $pgsql_path

if [[ $UID -eq 0 ]] ; then
  su - $user -c "'$install_path/bin/initdb' --pgdata='$pgsql_path/data' --encoding=utf8 --username=$user"
else
  "$install_path/bin/initdb" \
    --pgdata="$pgsql_path/data" \
    --encoding=utf8 \
    --username="$user"
fi

if [[ ! -d $pgsql_path/data ]] ; then
  log "\nSymlinking postgresql $version data directory...\n"
  rm -f "$pgsql_path/data"
  ln -nfs "$pgsql_path/$version"
fi
