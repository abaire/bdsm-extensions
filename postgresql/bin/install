#!/usr/bin/env bash

usage() {
  printf "
  Usage:

    $0 [options]

  options:

    --prefix   - specify prefix path
    --src)     - specify source directory
    --data)    - specify data directory
    --user)    - specify user to install as
    --version) - specify version to install
    --licence) - view licence
    --help)    - view this usage information

"
  return 0
}

log "

License:

$(cat -v ${extension_path}/LICENCE)

Message:

I am wayneeseguin in #rvm on irc.freenode.net and I am happy to discuss
improving this script, or field questions.

This script will install ${package_name}-${package_version} to
$install_path and configure the install.

"

source "${extension_modules_path}/bash/cli"

color_green="$(tput setaf 2)"
color_red="$(tput setaf 5)"
color_none="$(tput sgr0)"

configure_flags=(
  --prefix="$install_path"
  --datadir="$data_path"
  --with-openssl
  --enable-shared
)

if os_is_darwin ; then
  configure_flags[${#configure_flags[@]}]="--with-bonjour"
fi

install_package

# Post installation tasks.
ensure_user_exists "$package_user"

ensure_paths_exist "$data_path"

chown_paths "$user" "$data_path"

postgresql_init_script

postgresql_initdb

postgresql_ldconfig

postgresql_profile_d

postgresql_conf_d

configure_kernel_parameters

log "
Installation and configuration of postgresql is now complete.

  * postgresql has been installed to $install_path
  * postgresql configuration and data files will are in $data_path
  * You can control the postgresql server via the bdsm postgresql extension'
  * The postgersql superuser is '$package_user', no password.
  * Use /etc/conf.d/postgresql.conf for server startup customization.
"
