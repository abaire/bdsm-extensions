#!/usr/bin/env bash

usage() {
  printf "
  Usage:

    $0 [options]

  options:

    --prefix   - specify prefix path
    --src)     - specify source directory
    --data)    - specify data directory
    --user)    - specify user to install as
    --version) - specify version to install
    --licence) - view licence
    --help)    - view this usage information

"
  return 0
}

log "

License:

$(cat -v ${extension_path}/LICENCE)

Message:

I am happy to discuss improving this script, or field questions.

I am wayneeseguin in #rvm on irc.freenode.net

This script will install ${package}-${version} to
$install_path and configure the install.

"

number_of_args=${#extension_args[@]}
for ((index=0 ; index < $number_of_args ; index++)) ; do

  token="${extension_args[$index]}"

  case "$token" in
    --prefix)
      prefix_path="${extension_args[$((++index))]}"
      ;;
    --src)
      src_path="${extension_args[$((++index))]}"
      ;;
    --data)
      data_path="${extension_args[$((++index))]}"
      ;;
    --user)
      package_user="${extension_args[$((++index))]}"
      ;;
    --version)
      package_version="${extension_args[$((++index))]}"
      ;;
    --licence)
      cat -v "${extension_path}/LICENCE"
      exit 0
      ;;
    --help)
      usage
      exit 0
      ;;
    --trace)
      set -o xtrace
      ;;
    *)
      usage
      exit 1
      ;;
  esac

done

color_green="$(tput setaf 2)"
color_red="$(tput setaf 5)"
color_none="$(tput sgr0)"

configure_flags=(
  --prefix="$install_path"
  --datadir="$data_path"
  --with-openssl
  --enable-shared
)

if os_is_darwin ; then
  configure_flags[${#configure_flags[@]}]="--with-bonjour"
fi

install_package

# Post installation tasks.
ensure_user_exists "$package_user"

ensure_paths_exist "$data_path/$version"

chown_paths "$user" "$data_path"

postgresql_initdb

configure_kernel_parameters

log "

Installation and configuration of postgresql is now complete.

  * postgresql has been installed to $install_path
  * postgresql configuration and data files will are in $data_path
  * You can control the postgresql server via the bdsm postgresql extension'
  * The postgersql superuser is '$user', no password.
"
